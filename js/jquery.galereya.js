(function(e){"use strict";function t(t){var n=this;var r,i,s,o=e([]),u=e([]),a,f,l,c,h,p,d,v=e([]),m=e([]);var g=[],y=[],b=[],w=[],E,S,x,T=0,N=300,C,k,L,A=false,O;var M={spacing:0,wave:false,waveTimeout:300,modifier:"",slideShowSpeed:5e3,cellFadeInSpeed:200,noCategoryName:"selecciona album",disableSliderOnClick:false,load:function(e){e()}};var _={windowResize:function(){X()},bodyClick:function(t){if(e(t.target).closest(".galereya-cats").length===0){u.removeClass("open")}},categoriesListClick:function(t){var n=e(t.target),r=t.target.nodeName;if(r==="SPAN"){n=n.parent()}if(!n.is(":first-child")){W(n.find("span").text())}u.toggleClass("open")},cellClick:function(){if(!n.options.disableSliderOnClick){V(parseInt(this.getAttribute("data-visibleIndex"),10))}},sliderNextClick:function(){Q("next")},sliderPrevClick:function(){Q("prev")},sliderCloseClick:function(){J()},sliderPlayClick:function(){if(!O){Z()}else{et()}},bodyKeyDown:function(e){if(A){if(e.which===37||e.which===39){e.preventDefault()}}},bodyKeyUp:function(e){if(A){switch(e.which){case 27:J();break;case 37:c.click();break;case 39:l.click();break;default:}}}};var D=function(){n.addClass("galereya").addClass(n.options.modifier);j(function(){F();X();I();if(n.options.wave&&P()){z()}tt()})};var P=function(){var e=document.createElement("div").style,t="transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e;return t};var H=function(e){var t=e.css("transitionDuration")||e.css("webkitTransitionDuration")||e.css("mozTransitionDuration")||e.css("oTransitionDuration")||e.css("msTransitionDuration")||0;t=parseFloat(t)*1e3;return t};var B=function(){N=r.width();T=Math.floor(n.width()/(N+n.options.spacing));if(T<1){T=1}x=T*N+(T-1)*n.options.spacing};var j=function(t){var r;o=n.find("img").each(function(t,n){r={lowsrc:n.getAttribute("src")||"",fullsrc:n.getAttribute("data-fullsrc")||"",title:n.getAttribute("title")||n.getAttribute("alt")||"",description:n.getAttribute("data-desc")||"",category:n.getAttribute("data-category")||""};if(r.category){r.category=r.category.toLowerCase();if(e.inArray(r.category,y)===-1){y.push(r.category)}}g.push(r)});n.options.load(function(r){for(var i=0,s=r.length,u,a;i<s;i++){u=r[i];u.description=u.description||"";u.title=u.title||"";if(u.category){u.category=u.category.toLowerCase();if(e.inArray(u.category,y)===-1){y.push(u.category)}}a=e(document.createElement("img")).attr("src",u.lowsrc);n.append(a);o=o.add(a);g.push(u)}t()})};var F=function(){if(y.length>0){u=e('<ul class="galereya-cats" />');i=e('<div class="galereya-top" />');n.prepend(i.html(u));u.append('<li class="galereya-cats-item"><span>'+n.options.noCategoryName+"</span></li>");for(var t=0;t<y.length;t++){u.append('<li class="galereya-cats-item"><span>'+y[t]+"</span></li>")}}var v,m,b;o.wrapAll('<div class="galereya-grid" />').each(function(t,n){v=e(n);m=g[t].title;b=g[t].description;v.addClass("galereya-cell-img").wrap('<div class="galereya-cell" data-index="'+t+'"></div>').parent().append('<div class="galereya-cell-desc">                                <div class="galereya-cell-desc-title">'+m+'</div>                                <div class="galereya-cell-desc-text">'+b+"</div>                            </div>").append('<div class="galereya-cell-overlay" />')});r=n.find(".galereya-cell");s=n.find(".galereya-grid");a=e('<div class="galereya-slider" />');f=e('<div class="galereya-slider-container" />');l=e('<div class="galereya-slider-nav right" />');c=e('<div class="galereya-slider-nav left" />');h=e('<div class="galereya-slider-desc" />');p=e('<div class="galereya-slider-close" />');d=e('<div class="galereya-slider-play" />');a.addClass(n.options.modifier).append(f).append(l).append(c).append(h).append(h).append(p).append(d);e(document.body).append(a);n.show()};var I=function(t,r){t=t||0;if(t>=o.length){return}clearTimeout(k);if(r&&g[t].category!==r){setTimeout(function(){I(++t,r)},0);return}var i=o[t],s=function(){if(A){e(this).parent().show()}else{e(this).parent().fadeIn(n.options.cellFadeInSpeed,"linear")}k=setTimeout(function(){I(++t,r)},n.options.cellFadeInSpeed/2)};if(!i.complete){e(i).attr("src",i.src).load(s)}else{s.call(i)}q(t)};var q=function(t){var n=r[t],i;R(n,b.length);i=b.push(n)-1;e(n).addClass("visible").attr("data-visibleIndex",i)};var R=function(e,t){var r,i,s,o;o=t%T;r=o*N+n.options.spacing*o;if(t>=T){s=b[t-T];i=s.offsetTop+s.offsetHeight+n.options.spacing}else{i=0}e.style.top=i+"px";e.style.left=r+"px"};var U=function(){b=[];r.stop(true,true).fadeOut(200).removeClass("visible")};var z=function(t){t=t||0;if(t>=r.length){t=0}var i=e(r[t]);i.addClass("wave");setTimeout(function(){i.removeClass("wave");z(++t)},n.options.waveTimeout)};var W=function(e){u.empty().prepend('<li class="galereya-cats-item"><span>'+e+"</span></li>");U();if(e===n.options.noCategoryName){I(0)}else{u.append('<li class="galereya-cats-item"><span>'+n.options.noCategoryName+"</span></li>");I(0,e)}for(var t=0,r=y.length,i;t<r;t++){i=y[t];if(i!==e){u.append('<li class="galereya-cats-item"><span>'+i+"</span></li>")}}};var X=function(){B();if(m.length===0){m=v.find(".galereya-slide-img")}m.css("margin-top",(e(window).height()-m.height())/2);s.width(x);for(var t=0,n=b.length;t<n;t++){R(b[t],t)}};var V=function(t){if(A){setTimeout(function(){V(t)},50);return}et();f.empty();L=t;var n=H(a),r=function(){E=e("html").css("overflow");S=e("body").css("overflow");C=e(window).scrollTop();e("html, body").css("overflow","hidden")};a.show(0,function(){a.addClass("opened");if(P()){setTimeout(r,n+50)}else{r()}});A=true;Q();Y()};var J=function(){if(!A){return}e("html").css("overflow",E);e("body").css("overflow",S);e(window).scrollTop(C);var t=H(a),n=function(){et();w=[];f.empty();a.hide();A=false};a.removeClass("opened");if(P()){setTimeout(n,t+50)}else{n()}};var K=function(t){clearInterval(O);var n=b[t],r=parseInt(n.getAttribute("data-index"),10),i,s;i=e('<div class="galereya-slider-slide" />').html('<div class="galereya-slide-loader"></div>');s=e('<img class="galereya-slide-img" src="'+g[r].fullsrc+'" alt="'+g[r].title+'" />').load(function(){i.html(s);s.css("margin-top",(e(window).height()-s.height())/2);if(O){Z()}});return i};var Q=function(t){t=t||"next";if(O){et();Z()}var n,r=t.toLowerCase(),i,s,o=b.length;if(r==="next"){if(w.length===0){n=L;r=""}else{n=L+1;if(n>=o){return}}i=w[n];if(!i){i=K(n);i.addClass(r);f.append(i);w[n]=i}G(i,"current");G(v,"prev")}else if(r==="prev"){if(w.length!==0){r=""}n=L-1;if(n<0){return}i=w[n];if(!i){i=K(n);i.addClass(r);f.prepend(i);w[n]=i}G(i,"current");G(v,"next")}L=n;v=i;s=b[L].getAttribute("data-index");h.empty().html('<div class="galereya-slider-desc-title">'+g[s].title+" </div>"+g[s].description);m=i.find(".galereya-slide-img");m.css("margin-top",(e(window).height()-m.height())/2);Y()};var G=function(e,t){setTimeout(function(){e.removeClass("prev").removeClass("next").removeClass("current").addClass(t)},50)};var Y=function(){var e=b.length;if(L>=e-1){et();d.hide();l.hide()}else{d.show();l.show()}if(L<=0){c.hide()}else{c.show()}};var Z=function(){d.addClass("pause");O=setInterval(function(){l.click()},n.options.slideShowSpeed)};var et=function(){d.removeClass("pause");clearInterval(O);O=null};var tt=function(){e(window).bind("resize",_.windowResize);e(document.body).click(_.bodyClick).keydown(_.bodyKeyDown).keyup(_.bodyKeyUp);u.click(_.categoriesListClick);r.click(_.cellClick);l.click(_.sliderNextClick);c.click(_.sliderPrevClick);p.click(_.sliderCloseClick);d.click(_.sliderPlayClick)};this.options=e.extend({},M,t);this.openSlider=V;this.closeSlider=J;this.changeCategory=W;this.startSlideShow=Z;this.stopSlideShow=et;this.nextSlide=function(){l.click()};this.prevSlide=function(){c.click()};D();if(this.length>1){this.each(function(){e(this).galereya(t)})}return this}e.fn.galereya=t})(jQuery)